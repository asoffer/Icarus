package(default_visibility = ["//visibility:public"])

cc_library(
    name = "module_map",
    hdrs = ["module_map.h"],
    srcs = ["module_map.cc"],
    deps = [
        "//common:file",
        "//common:resources",
        "//ir:module",
        "//ir:deserialize",
        "@nth_cc//nth/io:file_path",
        "@nth_cc//nth/io:file",
        "@nth_cc//nth/io/reader:string",
        "@nth_cc//nth/io/serialize:deserialize",
        "@com_google_absl//absl/strings",
    ],
)

cc_binary(
    name = "compile",
    srcs = ["compile.cc"],
    deps = [
        ":module_map",
        "//common:debug",
        "//common:errno",
        "//common:file",
        "//common:string",
        "//diagnostics:message",
        "//diagnostics/consumer:streaming",
        "//ir",
        "//ir:declaration",
        "//ir:dependent_modules",
        "//ir:deserialize",
        "//ir:emit",
        "//ir:serialize",
        "//lexer",
        "//lexer:token_buffer",
        "//parse:parser",
        "@nth_cc//nth/commandline:main",
        "@nth_cc//nth/debug/log",
        "@nth_cc//nth/io:file",
        "@nth_cc//nth/io:file_path",
        "@nth_cc//nth/io/serialize",
        "@nth_cc//nth/io/writer:string",
        "@nth_cc//nth/process:exit_code",
        "@com_google_absl//absl/debugging:failure_signal_handler",
        "@com_google_absl//absl/debugging:symbolize",
    ],
)

cc_binary(
    name = "run_bytecode",
    srcs = ["run_bytecode.cc"],
    deps = [
        ":module_map",
        "//common:debug",
        "//common:errno",
        "//common:string",
        "//diagnostics:message",
        "//diagnostics/consumer:streaming",
        "//ir:dependent_modules",
        "//ir:deserialize",
        "//ir:module",
        "//ir:program_arguments",
        "//lexer:token_buffer",
        "@jasmin//jasmin/core:function",
        "@nth_cc//nth/commandline:main",
        "@nth_cc//nth/container:stack",
        "@nth_cc//nth/debug/log",
        "@nth_cc//nth/io:file",
        "@nth_cc//nth/io:file_path",
        "@nth_cc//nth/process:exit_code",
        "@com_google_absl//absl/debugging:failure_signal_handler",
        "@com_google_absl//absl/debugging:symbolize",
    ],
)
