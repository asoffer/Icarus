syntax = "proto3";

import "type/type_system.proto";

package ic;

message InstructionProto {
  enum OpCode {
    // Note: This needs to be kept in sync with the `jasmin::InstructionSet`
    // defined in "ir/function.h"
    CALL = 0;
    JUMP = 1;
    JUMP_IF = 2;
    RETURN = 3;
    PUSH = 4;
    PUSH_FUNCTION = 5;
    PUSH_STRING_LITERAL = 6;
    DROP = 7;
    TYPE_KIND = 8;
    TYPE_KIND_EQUALS = 9;
    PRINT = 10;
    ROTATE = 11;
    CONSTRUCT_FUNCTION = 12;
  }
  OpCode op_code = 1;
  repeated uint64 content = 2;
}

message FunctionProto {
  uint32 parameters = 1;
  uint32 returns = 2;
  repeated InstructionProto instructions = 3;
}

message ForeignFunctionProto {
  string name = 1;
}

message ModuleProto {
  // Subroutine at which to begin execution.
  FunctionProto initializer = 1;

  // Subroutines defined within the module.
  repeated FunctionProto functions = 2;

  repeated string string_literals = 3;

  repeated ForeignFunctionProto foreign_functions = 4;

  type.TypeSystem type_system = 5;

  map<uint32, string> identifiers = 6;
}
